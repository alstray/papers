%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\chapter{実行実験}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 

\newenvironment{tableA}{%
%  \scriptsize
  \tabcolsep = 3mm
%  \renewcommand{\arraystretch}{0.9}
  \begin{tabular}[t]{lrr}\hline
    インスタンス & 符号化1 & 符号化2\\\hline
    }{%
    \hline
  \end{tabular}
}
\newenvironment{tableB}{%
%  \scriptsize
%  \tabcolsep = 3mm
%  \renewcommand{\arraystretch}{0.9}
  \begin{tabular}[t]{lrrr}\hline
    インスタンス & 基準値 & 基本符号化 & 改良符号化 \\\hline
    }{%
    \hline
  \end{tabular}
}

実行実験により，以下のASP符号化を用いた2つの手法を比較する．
\begin{itemize}
	\item \textbf{基本符号化}: コード\ref{code:encode01}の，車両装備仕様問題の基本となる符号化
	\item \textbf{改良符号化}: コード\ref{code:encode02}の，基本符号化を改良した符号化
\end{itemize}

%提案手法の有効性を評価するために，表\ref{tab:instance}に示す，企業から提供された現実の問題を用いて実行実験を行った．
実験には表\ref{tab:instance}に示すような，タイプ数やオプション数，要求制約の数の違う3種類の
インスタンスを用いた．これらは，企業から提供していただいた現実の問題である．
また，それぞれのインスタンスで，CAFE基準値8.5, 9.0, 9.5, 10.0, 10.5km/Lの5通りに対して解を求めた．
ASPシステムには，広く普及している高速ASPソルバーclingo-5.4.0を使用した．
問題1問あたりのタイムアウトを実時間で2時間とした．
実験環境はMac mini, 3.2GHz, 64GBメモリである．

\begin{table}[htbp]
	\caption{インスタンス}
	\label{tab:instance}
	\centering
	\begin{tabular}{lrrrr}\\\hline
	インスタンス	&	タイプ数	&	オプション数	&	必須タイプ数	&	要求制約数	\\\hline
	small				&	8				&	21					&	8						&	4					\\
	medium			&	86			&	229					&	16					&	147				\\
	big					&	315			&	1337				&	172					&	0					\\\hline
	\end{tabular}
\end{table}

表\ref{tab:result1}に，各問題インスタンスに対して，それぞれの符号化で得られた，目的関数である販売台数の最良値を示す．
* 付きのものは，得られた値が最適値であることを示す．
太字の値は，2つの実行方法で得られた最良値のうち最大のものを表している．
最大の最良値を求めた問題数は，
基本符号化が7問，改良符号化が14問で，改良符号化の方が多くの問題で最大の最良値を求めている．
小規模なインスタンスsmallについては，基本符号化，改良符号化のどちらも5問すべてに対して最適解を
求めることに成功した．
大規模なインスタンスbigについては，最良符号化が5問すべてで基本符号化よりも優れた解を得ている．
このことから，特に大規模なインスタンスに対する改良符号化の有効性が確認できた．
タイムアウト内に解が得られなかった問題は，基本符号化が1問，改良符号化が0問であった．

\begin{table}[tbp]
  \caption{販売台数の比較}
  \label{tab:result1}
  \centering
  \begin{tableB}
    \input{data/result01}
  \end{tableB}
\end{table}


次に，2つの符号化について，最良値が求まるまでのCPU時間を比較評価する．
表\ref{tab:result2}に，2つの手法で最適値が得られた問題インスタンス5問のCPU時間を示す．
各問題に対して，最も時間の短いものを太字で示している．
改良符号化は5問中4問に対して，基本符号化より高速に最適解を見つけていることがわかる．
また，CPU時間の平均を見ると改良符号化は基本符号化のおよそ1/3である．
以上のことから，符号化を改良したことによって，求解の高速化が実現できたことがわかる．
%これらのことから，基本モデルに対して，改善モデルは性能が向上していると言える．
\begin{table}[tbp]
	\caption{最適解を得るために要したCPU時間(秒)}
	\label{tab:result2}
	\centering
	\begin{tabular}{crrr}\hline
 	インスタンス	& 基準値(km/L)                & 基本符号化  & 改良符号化   \\\hline
	small 	& 8.5  & 37.868          & \textbf{23.318}          \\
 	small	& 9.0  & 48.965          & \textbf{43.362}          \\
 	small	& 9.5  & \textbf{95.110}          & 173.172         \\
 	small	& 10.0 & 99.954          & \textbf{0.343}           \\
 	small	& 10.5 & 439.613         & \textbf{0.080}           \\\hline
	平均 	& 			 & 144.302			& \textbf{48.055}				\\\hline
%	幾何平均 & 		 & 95.028s		& 5.449s								\\
	\end{tabular}
\end{table}

最後に，表\ref{tab:result3}にて，コード\ref{code:encode01}の15行目，
コード\ref{code:encode02}の21, 22行目の，アトム\code{iwr(S,G)}を生成するためのルールを
基礎化することで生まれるルールの数を比較する．
このとき，CAFE基準値は9.0km/Lとしている．
括弧内の数字は，基本符号化のルール数を1.0としたときの比である．
改良符号化は，インスタンスsmall, mediumでは基本符号化の1/5ほどに，インスタンスbigでは
1/50ほどになっており，大幅にルール数が減っていることがわかる．
このルールは，IWR値の和の候補の数だけ生成されるため，基本符号化ではすべてのオプションの組み合わせ
によるIWR値の和を示すルールを生成していたのに対して，改良符号化で上下限を厳密に求めることで，
実現不可能なIWR値の和を示すルールの大部分が生成されなくなったことが，ルール数の減少の要因であると
考えられる．
そして，このルール数の減少が，改良符号化の性能の向上に繋がったと考えられる．

%2つの符号化について，基礎化によって生成される制約数を比較評価する．
%表\ref{tab:result3}に，ASPソルバー{\clingo}が計算の過程で生成した制約の数を示す．
%改良符号化の括弧内の数字は，基本符号化に対する制約数の比である．
%すべての問題インスタンスについて，改良符号化の方が制約数が少なく，
%特に大規模な問題に対して大きく差が出ている．全体の平均としては，
%改良符号化では基本符号化に対して制約の数の比が約0.39であり，
%制約の数が半分以下になっていることがわかる．
%これは，IWR値の和の候補を求める際，上下限を加えることで，
%ほかの制約によって明らかに実現不可能な，IWR値の和が極端に大きい，
%あるいは，極端に小さい組合せを除外し，無駄なルールの生成を削減したことが理由と考えられる．
%さらに，IWRの和の候補が削減されることで，それを元に生成される装備仕様の燃費や販売台数の
%候補も削減される．
%したがって，燃費制約を符号化する際に，IWR値の和の候補の範囲を厳密に求めることは有効であると思われる．
%このような，生成される制約の数の削減が，改良符号化の性能の向上につながったと考えられる．



\begin{table}[tbp]
	\caption{ルール数の比較}
	\label{tab:result3}
	\centering
	\begin{tabular}{crr} \hline
	インスタンス	& 基本符号化		& 改良符号化 \\\hline
	small				& 2,820(1.0) & 576(0.20) \\
	medium			& 7,545(1.0) & 1,758(0.23) \\
	big					& 62,745(1.0) & 1,488(0.02) \\ \hline

	\end{tabular}
\end{table}

%\begin{table}[htbp]
%	\caption{制約数の比較}
%	\label{tab:result3}
%	\centering
%	\begin{tabular}{crrr} \hline
%	インスタンス	& 基準値(km/L)	&   基本符号化		& 改良符号化 \\\hline
%	small	& 8.5   &         83511 &         32846 (0.39) \\
%	small	&	9.0   &         83520 &         32855 (0.39) \\
%	small	& 9.5   &         83520 &         32855 (0.39) \\
%	small	& 10.0  &         83529 &         32864 (0.39) \\
%	small	& 	10.5  &         83529 &         14152 (0.17) \\
%	medium 	& 8.5  &         92987 &         56931 (0.61) \\
%	medium	& 9.0  &         92996 &         56940 (0.61) \\
%	medium	& 9.5  &         93035 &         56958 (0.61) \\
%	medium	& 10.0 &         93023 &         56967 (0.61) \\
%	medium	& 10.5 &         93053 &         56976 (0.61) \\
%	big		& 8.5     &        155645 &          8004 (0.05) \\
%	big		& 9.0     &        155654 &         42190 (0.27) \\
%	big		& 9.5     &        155672 &         42208 (0.27) \\
%	big		& 10.0    &        155681 &         42217 (0.27) \\
%	big		& 10.5    &        155690 &         42226 (0.27) \\\hline
%	\end{tabular}
%\end{table}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "paper"
%%% End:
