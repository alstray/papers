% Created by Takeuchi on Aug. 2020
\documentclass[dvipdfmx, 11pt]{beamer}

%%%% Packages %%%%%
%\usepackage{bxdpx-beamer}
%\usepackage{minijs}
%\usepackage{otf}
%\usepackage{tabularx}
%\usepackage{graphicx}
% \usepackage{graphicx}
% \usepackage{amsmath,amssymb,amsthm}
% \usepackage{multirow}
\usepackage{multicol}
% \usepackage{url}
\usepackage{tikz}
\usetikzlibrary{arrows,shapes}
\usetikzlibrary{positioning}
% \usepackage{alltt}
% \usepackage{bm}
 \usepackage{listings,jlisting}
% \usepackage{listings}
% \lstset{
%  basicstyle=\ttfamily\scriptsize,
%  keepspaces=true,
%  escapechar=|,
%  columns=[l]{fullflexible}
% }

%%%% Fonts %%%%%
\renewcommand{\kanjifamilydefault}{\gtdefault}
% \usepackage{otf} % otfパッケージ
\usepackage[deluxe]{otf} 
\usepackage{txfonts} % 数式・英文ローマン体を Lxfont にする
% \usepackage[T1]{fontenc} % 8bit フォント
% \usepackage{minijs}
% \usepackage{textcomp} % 欧文フォントの追加
% \usepackage[utf8]{inputenc} % 文字コードをUTF-8

%%%%% Beamer %%%%%
\usetheme{Madrid}
\useinnertheme{rectangles}
%\useoutertheme{smoothbars}
\setbeamercolor{enumerate}{fg=white, bg=black}
\usefonttheme{professionalfonts}
\setbeamertemplate{frametitle}[default][center]
\setbeamertemplate{navigation symbols}{}
% \setbeamercovered{transparent} % 好みに応じてどうぞ
\setbeamertemplate{footline}[frame number]
\setbeamercolor{page number in head/foot}{fg=black} % ページ数を表示する
% \setbeamerfont{footline}{size=\normalsize,series=\bfseries}
\setbeamerfont{footline}{size=\scriptsize,series=\mdseries}
\setbeamercolor{footline}{fg=black,bg=black}
\setbeamertemplate{blocks}[rounded][shadow=true]
\setbeamertemplate{items}[ball]
% \setbeamertemplate{enumerate items}[default]
% \setbeamerfont{alerted text}{series=\bfseries}

%%%% Code %%%%%%%%%
\lstset{
 basicstyle=\ttfamily\color{black},
 keepspaces=true,
 escapechar=|,
 columns=[l]{fullflexible},
 commentstyle={\color{red}},
 stringstyle={\color{blue}},
 % literrate =%
 %   {:-}{{\textcolor{black}{:-}}}2%
 %   {,}{{\textcolor{black}{,}}}1%
 %   {.}{{\textcolor{black}{.}}}1%
}

%%%% My macro %%%%%
\input{macro}
\input{ovm_macro}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{車両装備仕様問題に対する\\解集合プログラミングの適用}
\author{竹内 頼人\inst{1} \and 田村 直之\inst{2} \and 番原 睦則\inst{1}}
\institute{\inst{1}名古屋大学 \and \inst{2}神戸大学}

\date{日本ソフトウェア科学会第37回大会(2020年度)}
\begin{document}
\begin{frame} {}
 \titlepage
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{車両装備仕様問題}
 \begin{itemize}
  \item 車両の装備を決定するには，販売される国や地域の法規や規制，
    地域や市場の特性，市場の嗜好や競合など十分に考慮する必要がある．
  \item 現状では専門知識をもつ技術者の多大な労力が費やされている．
  \item 車両装備仕様探索の自動化・効率化は自動車メーカーにとって重要な課題の一つである．
  % \item 日本では2020年度から，
  % 	\structure{\bf 企業別平均燃費}
  % 	(Corporate Average Fuel Efficiency; \structure{\bf CAFE})基準
  % 	と呼ばれる燃費規制が採用されている．
 \end{itemize}
 \vfill
 \begin{alertblock}{車両装備仕様問題}
  \begin{itemize}
   \item 組合せ最適化問題として定式化される．
   \item \alert{範囲制約}，\alert{要求・排他制約}，\alert{燃費制約}，
	 \alert{初期制約}から構成される．
   \item \alert{予想販売台数を最大化}する{\bf 装備仕様}
	 (装備タイプと装備オプションの組合せ)を求めることが目的である．
  \end{itemize}
 \end{alertblock}
 % \begin{itemize}
 %  \item 本発表では，燃費制約として企業平均燃費
 % 	(Corporate Average Fuel Efficiency; \structure{\bf CAFE})方式を用いる．
 % \end{itemize}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{CAFE問題}
本発表では，燃費制約として企業平均燃費
(Corporate Average Fuel Efficiency; \structure{\bf CAFE})方式を用いる
車両装備仕様問題(\structure{\bf CAFE問題})を扱う．
 % \begin{exampleblock}{}
 %  \centering
 %  ここにCAFE方式の装備仕様と燃費を表すグラフ
 % \end{exampleblock}
 \begin{block}{CAFE方式}
  \begin{itemize}
   \item 欧米で採用されており，日本でも2020年度から導入されている自動車の燃費規制
   \item 車種別ではなくメーカー全体での出荷台数を加味した平均燃費を算出し，規制をかける方式
	 \[
	 \begin{array}{lcr}
	  & & \\
	  \underbrace{
	   \displaystyle\frac{\sum_{i=1}^{n} FE_{i}\cdot SV_{i}}
	   {\sum_{i=1}^{n} SV_{i}}}_{\mbox{平均燃費}
	   }
	   &
	   \geq 
	   &
	   t \\
	 \end{array}
	 \]
	 % CAFE基準値を$t$，装備仕様の個数を$n$とする．	 
	 % 装備仕様$i$の車両の燃費を$FE_i$，予想販売台数を$SV_i$とする．

  \end{itemize} 
 \end{block}
\begin{itemize}
 \item ある特定の車種では燃費基準を達成できなくても，他の車種の燃費を向上させることで
       基準を達成できることが可能
\end{itemize}
 % \begin{block}{CAFE方式の特長}
 %  ある特定の車種では燃費基準を達成できなくても，他の車種の燃費を向上させることで
 %  基準を達成できることが可能な点
 % \end{block}
 % 以降，CAFE方式に基づく車両装備仕様問題を\structure{CAFE問題}と呼ぶ．
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{CAFE問題の例}
 \begin{itemize}
  \item 可変性モデル(Orthogonal Variability Model; OVM)でCAFE問題の例を記述
 \end{itemize}
 \scalebox{0.8}[0.8]{%
 \input{ovm} 
 }
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \begin{frame}{燃費制約と目的関数}
%  \begin{itemize}
%   \item 装備仕様$i$の車両の燃費を$FE_i$，予想販売台数を$SV_i$とする．
%  \end{itemize}
%  \begin{block}{燃費制約}
%   \begin{itemize}
%    \item CAFE基準値を$t$，装備仕様の個数を$n$とする．
%   \end{itemize} 
%   \[
%   \begin{array}{lcr}
%    & & \\
%    \underbrace{\displaystyle\frac{\sum_{i=1}^{n} FE_{i}\cdot SV_{i}}{\sum_{i=1}^{n} SV_{i}}}_{\mbox{平均燃費}}
%     &
%     \geq 
%     &
%     t \\
%    & & 
%   \end{array}
%   \]
%  \end{block}
%  \begin{block}{目的関数}
%   \begin{itemize}
%    \item 全体の予想販売台数の和を最大化
%   \end{itemize}
%   \[
%   \begin{array}{lcr}
%    & & \\
%    \sum_{i=1}^{n}{SV_{i}} & \longrightarrow & \mbox{最大} \\
%    & & 
%   \end{array}
%   \]
%  \end{block}
% \end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{CAFE問題の解}
 \begin{itemize}
  \item CAFE基準値：9.0km/L
  \item 装備仕様の数：3
  \item 初期制約：(装備仕様1, STD), (装備仕様2, DX), (装備仕様3, LX)
 \end{itemize}
 \begin{exampleblock}{}
  \centering
  \begin{tabular}{l|l|c|c|c} 
    %\multicolumn{1}{c|}{装備}   & \multicolumn{3}{c}{装備仕様} \\ \cline{2-4}
    \multicolumn{2}{l|}{装備仕様}               & 1	& 2 	 & 3	\\  \hline
    装備 & \textsf{Grade}        & \textsf{STD}    & \textsf{DX}     & \textsf{LX}\\
    &\textsf{Drive\_Type}  & \textsf{2WD}    & \textsf{2WD}    & \textsf{2WD}\\
    &\textsf{Engine}	  & \textsf{V4}     & \textsf{V6}     & \textsf{V6}\\
    &\textsf{Tire}	  & \textsf{16inch} & \textsf{17inch} & \textsf{18inch}\\
    &\textsf{Transmission} & \textsf{5MT}    & \textsf{6MT}    & \textsf{10AT}\\
    &\textsf{Sun\_Roof}    & -               & \textsf{Normal} & -  \\ \hline
    \multicolumn{2}{l|}{IWR 値の総和}           & 983  & 1,125   & 1,180 \\ %\hline
    \multicolumn{2}{l|}{燃費(km/L)}      & 10.2  & 8.9     & 8.5 \\ %\hline
    \multicolumn{2}{l|}{予想販売台数}    & 745   & 1,988   & 1,171  \\ \hline
    \multicolumn{2}{l|}{平均燃費(km/L)}  & \multicolumn{3}{c}{9.0} \\ 
    \multicolumn{2}{l|}{予想販売台数(合計)}  & \multicolumn{3}{c}{3,904} \\ 
  \end{tabular}
 \end{exampleblock}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{CAFE問題の解}
 \begin{itemize}
  \item CAFE基準値：8.5km/L
  \item 装備仕様の数：3
  \item 初期制約：(装備仕様1, STD), (装備仕様2, DX), (装備仕様3, LX)
 \end{itemize}
 \begin{exampleblock}{}
  \centering
  \begin{tabular}{l|l|c|c|c} 
    %\multicolumn{1}{c|}{装備}   & \multicolumn{3}{c}{装備仕様} \\ \cline{2-4}
    \multicolumn{2}{l|}{装備仕様}               & 1	& 2 	 & 3	\\  \hline
    装備 & \textsf{Grade}        & \textsf{STD}    & \textsf{DX}     & \textsf{LX}\\
    &\textsf{Drive\_Type}  & \textsf{2WD}    & \textsf{2WD}    & \alert{4WD}\\
    &\textsf{Engine}	  & \alert{V6}     & \textsf{V6}     & \textsf{V6}\\
    &\textsf{Tire}	  & \textsf{16inch} & \textsf{17inch} & \textsf{18inch}\\
    &\textsf{Transmission} & \alert{6AT}    & \alert{HEV}    & \textsf{10AT}\\
    &\textsf{Sun\_Roof}    & -               & \alert{-} & -  \\ \hline
    \multicolumn{2}{l|}{IWR 値の総和}           & 1,130  & 1,130   & 1,255 \\ %\hline
    \multicolumn{2}{l|}{燃費(km/L)}      & 8.8  & 8.8     & 8.0 \\ %\hline
    \multicolumn{2}{l|}{予想販売台数}    & 2,007   & 2,007   & 1,511  \\ \hline
    \multicolumn{2}{l|}{平均燃費(km/L)}  & \multicolumn{3}{c}{8.5} \\ 
    \multicolumn{2}{l|}{予想販売台数(合計)}  & \multicolumn{3}{c}{5,525} \\ 
  \end{tabular}
 \end{exampleblock}
 \footnotetext{CAFE基準値9.0km/Lの装備仕様との相違点を赤字で示す．}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{CAFE問題の解}
 \begin{itemize}
  \item CAFE基準値：9.5km/L
  \item 装備仕様の数：3
  \item 初期制約：(装備仕様1, STD), (装備仕様2, DX), (装備仕様3, LX)
 \end{itemize}
 \begin{exampleblock}{}
  \centering
  \begin{tabular}{l|l|c|c|c} 
    %\multicolumn{1}{c|}{装備}   & \multicolumn{3}{c}{装備仕様} \\ \cline{2-4}
    \multicolumn{2}{l|}{装備仕様}               & 1	& 2 	 & 3	\\  \hline
    装備 & \textsf{Grade}        & \textsf{STD}    & \textsf{DX}     & \textsf{LX}\\
    &\textsf{Drive\_Type}  & \textsf{2WD}    & \textsf{2WD}    & \alert{4WD}\\
    &\textsf{Engine}	  & \textsf{V4}     & \alert{V4}     & \textsf{V6}\\
    &\textsf{Tire}	  & \textsf{16inch} & \textsf{17inch} & \textsf{18inch}\\
    &\textsf{Transmission} & \textsf{5MT}    & \alert{5MT}    & \textsf{10AT}\\
    &\textsf{Sun\_Roof}    & -               & \alert{-} & \alert{Panorama}  \\ \hline
    \multicolumn{2}{l|}{IWR 値の総和}           & 983  & 1,003   & 1,325 \\ %\hline
    \multicolumn{2}{l|}{燃費(km/L)}      & 10.2  & 10.0     & 7.5 \\ %\hline
    \multicolumn{2}{l|}{予想販売台数}    & 745   & 630   & 324  \\ \hline
    \multicolumn{2}{l|}{平均燃費(km/L)}  & \multicolumn{3}{c}{9.6} \\ 
    \multicolumn{2}{l|}{予想販売台数(合計)}  & \multicolumn{3}{c}{1699} \\ 
  \end{tabular}
 \end{exampleblock}
 \footnotetext{CAFE基準値9.0km/Lの装備仕様との相違点を赤字で示す．}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{解集合プログラミング(Answer Set Programming; ASP)}
 \begin{itemize}
 \item \structure{\bf ASP言語}は，一階論理に基づく知識表現言語の一種である．
 \item \structure{\bf ASPプログラム}は，ASPルールの有限集合である．
 \item \structure{\bf ASPシステム}は，安定モデル意味論~[Gelfond and Lifschitz '88]
   に基づく解集合を計算するシステムである．
 \item 近年，SAT技術を利用した高速なASPシステムが開発され，
%   ロボット工学，システム検証，システム生物学，
   スケジューリング，システム生物学
   など様々な分野への実用的応用が急速に拡大している．
 \end{itemize}
\vfill
 \begin{alertblock}{車両装備仕様問題に対してASPを用いる利点}
   \begin{itemize} 
    \item ASP言語の高い表現力により，各種制約を簡潔に記述できる．
    \item 高速なASPシステムを利用できる．
	  \begin{itemize}
	   \item 一階ASPプログラムを命題ASPプログラムに\alert{\bf 基礎化}した後，
		 解集合を求めるシステムが主流
	  \end{itemize}
    \item 解の最適性を保証でき，最適解の列挙も可能である．
   \end{itemize}
 \end{alertblock}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{ASPの記法}
 \begin{alertblock}{}
  ASP言語は論理プログラム\footnotemark
  をベースとしている．
 \end{alertblock}
 \begin{itemize}
  \item \structure{論理プログラム}とは，以下の\structure{ルール}の有限集合である．
	\begin{center}
	 $a_0$ \code{:-} $a_1$\code{,...,}$a_m$\code{,not} $a_{m+1}$\code{,...,} $a_n$\code{.}
	\end{center}
  	% \[
  	% \underbrace{a_0}_{\mbox{ヘッド}} \leftarrow 
  	% \underbrace{a_1,\dots,a_m,\naf{a_{m+1}},\dots,\naf{a_n}}_{\mbox{ボディ}}
  	% \]
  	$0 \leq m \leq n$ であり，各 $a_i$ はアトム，
  	\code{not}は\structure{デフォルトの否定}，\\
  	``\code{,}''は連言(AND)を表す．
  \item \alert{直感的な意味}は，
  	「$a_1$\code{,...,}$a_m$がすべて成り立ち，
  	$a_{m+1}$\code{,...,}$a_n$のそれぞれが成り立たないならば，
  	$a_0$が成り立つ」である．
  \item ボディが空のルールを\structure{ファクト}と呼び，``\code{:-}''は省略できる．
  \item ヘッドが空のルールを\structure{一貫性制約}と呼び，
	ボディのリテラルの連言が成り立たないことを表す．
 \end{itemize}
 \footnotetext{本発表では標準論理プログラムを単に論理プログラムと呼ぶ．}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \begin{frame}{ASPの記法}
%  \begin{itemize}
%   \item ボディが空のルールを\structure{ファクト}と呼び，``$\leftarrow$''は省略してよい．
% 	\[
% 	 \underbrace{a_0}_{\mbox{ヘッド}}
% 	\]
% 	$a_0$が成り立つことを表す．
%   \item ヘッドが空のルールを\structure{一貫性制約}と呼ぶ．
% 	\[
% 	 \leftarrow 
% 	 \underbrace{a_1,\dots,a_m,\naf{a_{m+1}},\dots,\naf{a_n}}_{\mbox{ボディ}}
% 	\]
% 	ボディのリテラル($a_i$あるいは$\naf{a_i}$)の連言が成り立たないことを表す．
%  \end{itemize} 
% \end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{ASPの記法(拡張構文)}
 \begin{itemize}
  \item \structure{選択子}
	\begin{center}
	 \code{\{}$a_1$\code{;...;}$a_n$\code{\}}
	\end{center}
	アトム集合 $\{a_1,\dots,a_n\}$
	の任意の部分集合が成り立つことを意味する．
  \item \structure{個数制約}
	\begin{center}
	 $lb$\ \code{\{}$a_1$\code{;...;}$a_n$\code{\}}\ $ub$
	\end{center}
	$a_1,\dots,a_n$ のうち，
	$lb$個以上，$ub$個以下が成り立つことを意味する．
  \item \structure{重み付き個数制約}
	\begin{center}
	 $t$ \code{= \#sum} \code{\{} $w_1$\code{:}$a_1$\code{;...;}$w_n$\code{:}$a_n$ \code{\}}
	\end{center}
	$a_1,\dots,a_n$のうち，
	成り立つアトムの重み和が項$t$に等しくなることを意味する．
 \end{itemize}
 これら以外にも，組合せ最適化問題を解くための
 \structure{最小化関数・最大化関数}なども用意されている．
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{研究目的}
 \begin{alertblock}{目的}
  ASP技術を活用して，大規模な車両装備仕様問題を効率よく解くシステム
  を実現すること．
 \end{alertblock}
 \begin{block}{既存研究}
  \begin{itemize}
   \item CAFE問題に対するASP符号化(基本符号化と呼ぶ)
   \item Babieca・神戸大学・名古屋大学 共同研究(2019)
  \end{itemize}
 \end{block}
 \begin{block}{研究内容}
  \begin{enumerate}
   \item \structure{\bf CAFE問題ソルバーを提案}
	 \begin{itemize}
	  \item \alert{\bf IWR値の和の上下限を厳密に計算する}改良符号化を考案
	        % \item この改良により，基礎化後のルール数を少なく抑えることができ，
		% 大規模な問題に対する有効性が期待できる．
	  \item オプション数を最小化する拡張符号化を考案(ソルバーの拡張性を確認)
	 \end{itemize}
   \item 企業から提供された実データを用いた実験・評価
	 \begin{itemize}
	  \item 小規模な問題に対して，最適解を得ることができた．
	  \item 大規模な問題に対して，改良符号化の有効性を確認できた．
	 \end{itemize}
  \end{enumerate}
 \end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 \begin{frame}{提案するCAFE問題ソルバーの構成}
  \scalebox{0.9}{%
  \centering
  \input{arch}
  }
  % \begin{itemize}
  %  \item ソルバーの
  %  \item 流れを
  %  \item 箇条書き
  % \end{itemize}
  \begin{block}{ASP符号化}
   \begin{itemize}
    \item \structure{\bf 基本符号化}
	  \begin{itemize}
	   \item ルール17個で記述可能
	   \item ソルバーの簡潔性を確認
	  \end{itemize}
    \item \structure{\bf 改良符号化}
	  \begin{itemize}
	   \item IWR値の上下限を基本符号化より厳密に計算
	   \item ルール数を少なく抑えることが可能
	  \end{itemize}
    \item \structure{\bf 拡張符号化}
	  \begin{itemize}
	   \item オプション数を最小化する目的関数を追加
	   \item ソルバーの拡張性を確認
	  \end{itemize}

	  
   \end{itemize}
  \end{block}
   % \begin{block}{CAFE問題ソルバーの特長}
   %  \begin{itemize}
   %   \item {\bf 簡潔性}\\
   % 	   CAFE問題の制約をルール17個で簡潔に記述
   %   \item {\bf 柔軟性}\\
   % 	   目的関数を自由に追加可能．
   %   \item {\bf 拡張性}\\
   % 	   ルールを追加するだけで新しい制約を導入可能．
   %  \end{itemize}
   % \end{block}
  % \begin{itemize}
  %  \item 表記法
  % \end{itemize}
  % \begin{center}
  %  %\tabcolsep = 2mm
  % \begin{tabular}{l|ccccc}\small
  %    論理プログラム &  $\leftarrow$ & $,$      & $;$      & $\sim$    & $\#sum$ \\\hline
  %    ソースコード   & \code{:-}     & \code{,} & \code{;} & \code{not} & \code{\#sum}
  % \end{tabular}
  % \end{center}

 \end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{CAFE問題のASPファクト表現}
  \begin{multicols}{2}
   \scriptsize
   \lstinputlisting{codes/ovm.lp}
  \end{multicols}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]{基本符号化：解候補の生成，範囲制約}
 \begin{exampleblock}{}
  \begin{lstlisting}
   (1) { vp(VP,G) } :- vp_def(VP), group(G). 
   (2) :- not vp(VP,G), require_vp(VP), group(G).
   (3) 1 { v(V,G) : v_def(V,VP,_) } 1 :- vp(VP,G).
  \end{lstlisting}
 \end{exampleblock}
 \begin{itemize}
  \item アトム\scode{vp(VP,G)}は装備仕様\code{G}が
   	タイプ\code{VP}を装備することを意味
  \item アトム\scode{v(V,G)}は装備仕様\code{G}が
	オプション\code{V}を装備することを意味
  \item (1)より，各装備仕様\code{G}，各タイプ\code{VP}に対して，
	\code{vp(VP,G)}の候補を生成
  \item (2)は，各装備仕様\code{G}に対して，
	\code{VP}が必須タイプならば，\code{G}は\code{VP}を
	装備しなければならないことを表す．
  \item (3)は，タイプ\code{VP}を装備する装備仕様\code{G}に対して，
	\code{VP}のオプションからちょうど1個を実装することを表す．
  \end{itemize}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]{基本符号化：要求・排他制約}
 \begin{exampleblock}{}
  \begin{lstlisting}
   (4) :- require_v_v(V1,V2), v(V1,G), not v(V2,G).
   (5) :- exclude_v_v(V1,V2), v(V1,G), v(V2,G).
  \end{lstlisting}
 \end{exampleblock}
 \begin{itemize}
  \item (4)は，オプション\code{V1}, \code{V2}間に要求制約があるとき，
	装備仕様\code{G}がオプション\code{V1}を実装するならば，
	\code{G}は\code{V2}を実装しなければならないことを表す．
  \item (5)は，オプション\code{V1}, \code{V2}間に排他制約があるとき，
	装備仕様\code{G}が\code{V1}と\code{V2}を
	同時に実装してはならないことを表す．
  \item \code{VP}間や\code{VP},\code{V}間でも同様に記述できる．
 \end{itemize}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]{基本符号化：燃費制約}
 \begin{exampleblock}{}
  \small
  \begin{lstlisting}
   (6) iwr(S,G) :- 
           S = #sum { IWR,V : v(V,G), v_def(V,_,IWR) }, group(G).
   (7) fe(FE,G) :- iwr(S,G), fe_map(S,FE).
   (8) sv(SV,G) :- iwr(S,G), sv_map(S,SV).
   (9) :- not 0 #sum { (FE-t)*SV,FE,SV,G : fe(FE,G), sv(SV,G) }.
  \end{lstlisting}
 \end{exampleblock}
 \begin{itemize}
  \item \scode{iwr(S,G)}は，装備仕様\code{G}の
	IWR値の総和が\code{S}であることを表す．
  \item \scode{fe(FE,G)}と\scode{sv(SV,G)}は，
	それぞれ装備仕様\code{G}の燃費\code{FE}と予想販売台数\code{SV}を表す．
  \item (9)は，CAFE方式の燃費制約の式を以下のように変形し，
	ASPの重み付き個数制約で表現している．
	\[
	 \sum_{i=1}^{n} (FE_{i}-t)\cdot SV_{i} \geq 0
	\]
 \end{itemize}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]{基本符号化：初期制約，目的関数}
 \begin{exampleblock}{}
  \begin{lstlisting}
   (10) :- not v(V,G), require_g_v(G,V).
   (11) #maximize { SV,G : sv(SV,G) }.
  \end{lstlisting}
 \end{exampleblock}
 \begin{itemize}
  \item (10)は，装備仕様\code{G}がオプション\code{V}を実装しなければならない
	という初期制約を表す．
  \item (11)は，最大化関数\code{#maximize}によって目的関数である
	予想販売台数の最大化を表す．
 \end{itemize}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{基本符号化の改良点}
 \begin{block}{問題の入力}
  \begin{itemize}
   \item $VP$:\ タイプの集合
   \item $VP*$:\ 必須なタイプの集合
   \item $V$:\ オプションの集合
   \item $V_i$:\ タイプ$i \in VP$ が実装可能なオプションの集合
   \item $w_j$:\ オプション$j \in V$ のIWR値
  \end{itemize}
 \end{block}
 \begin{block}{IWR値の総和\code{S}の上下限}
  \[
   0 \leq \texttt{S} \leq \sum_{j\in V}w_{j}
  \]
 \end{block}
 \alert{各タイプが選択可能なオプション数の上下限，必須かどうかの別を考慮}
 \begin{alertblock}{}
  \[
   \sum_{i\in VP^{*}}\min_{j\in V_{i}}w_{j}
   \leq \texttt{S} \leq
   \sum_{i\in VP}\max_{j\in V_{i}}w_{j}
  \]
 \end{alertblock}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}[fragile]{改良符号化}
 基本符号化の(6)を以下のコードで置き換える．
\begin{exampleblock}{}
 \footnotesize
 \begin{lstlisting}
  ub_vp(UB,VP) :- UB = #max { IWR,V : v_def(V,VP,IWR) }, vp_def(VP).
  lb_vp(LB,VP) :- LB = #min { IWR,V : v_def(V,VP,IWR) }, vp_def(VP).

  ub_iwr(S) :- S = #sum { UB,VP : ub_vp(UB,VP) }.
  lb_iwr(S) :- S = #sum { LB,VP : lb_vp(LB,VP), require_vp(VP) }.

  iwr(S,G) :- S = #sum { IWR,V : v(V,G), v_def(V,_,IWR) },
      LB <= S, S <= UB, lb_iwr(LB), ub_iwr(UB), group(G).
 \end{lstlisting}
\end{exampleblock}
 \begin{itemize}
  \item アトム\scode{lb_iwr(LB)}は，下限値が各必須タイプが選択可能なオプション
	のIWR値の最小値の総和であることを表す．
  \item アトム\scode{ub_iwr(UB)}は，上限値が各タイプが選択可能なオプション
	のIWR値の最大値の総和であることを表す．
 \end{itemize}
 \begin{block}{}
  \scode{iwr(S,G)}に関する基礎化後のルール数を少なく抑えることが可能
 \end{block}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{実験}
 考案したASP符号化の有効性を評価するために実験を行なった．
 \begin{itemize}
  \item ベンチマーク問題(計15問)
	\begin{itemize}
	 \item 企業から提供された問題(3問)に対して
	 \item 5通りのCAFE基準値$X \in \{8.5, 9.0, 9.5, 10.0, 10.5km/L\}$で生成
	 \item 求める装備仕様の数$G = 3$
	\end{itemize}
	\begin{exampleblock}\small
	 \centering
	 \begin{tabular}{ l|r r r }
	  問題		& 装備タイプ数	& 装備オプション数& 要求制約数 	\\ \hline
	  small	        & 8     	& 21		& 4		\\
	  medium	& 86		& 226		& 147	\\
	  big		& 315		& 1,337		& 0		\\
	 \end{tabular}
	\end{exampleblock}
  \item ASPシステム: \textit{clingo-5.4.0}
  \item 制限時間: 1問あたり2時間
  \item 実験環境: Mac mini(3.2GHz, Intel Core i7, 64GB メモリ)
 \end{itemize}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{実験結果}
 \begin{exampleblock}{}
  \centering
  \scriptsize
  \begin{tabular}{l|r|r|r}
   \lw{問題} & CAFE  & \multicolumn{2}{c}{販売台数} \\ \cline{3-4}
            & 基準値 & 基本符号化 & 改良符号化 \\\hline    
   small & 8.5   & \alert{6,021*} & \alert{6,021*}       \\
   small & 9.0   & \alert{5,007*} & \alert{5,007*}       \\
   small & 9.5   & \alert{2,688*} & \alert{2,688*}       \\
   small & 10.0  & \alert{1,318*} & \alert{1,318*}       \\
   small & 10.5  & UNSAT          & UNSAT    \\\hline
   medium & 8.5  & 6,010          & \alert{6,021}        \\
   medium & 9.0  & \alert{5,595}  & \alert{5,595}        \\
   medium & 9.5  & \alert{3,447}  & 3,430        \\
   medium & 10.0 & 2,245          & \alert{2,250}        \\
   medium & 10.5 & 1,690          & \alert{1,845}        \\\hline
   big & 8.5     & TO             & \alert{3,877}        \\
   big & 9.0     & 1,038          & \alert{4,623}        \\
   big & 9.5     & 688            & \alert{3,121}        \\
   big & 10.0    & 1,634          & \alert{2,064}        \\
   big & 10.5    & 538            & \alert{904}         \\\hline
   \multicolumn{2}{l}{最適値・最良値の数} & \multicolumn{1}{r}{6} & \alert{13} \\
  \end{tabular}
 \end{exampleblock}
 \begin{itemize}\small
  \item 改良符号化は，より多くの問題に対して優れた結果を示した．
  \item 大規模な問題に対する改良符号化の有効性が確認できた．
  \item 小規模な問題 small については両符号化ともに5問全てに対して最適解(あるいはUNSAT)を
	求めることができた．
 \end{itemize}	
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{実験結果}
 問題 small について，それぞれの符号化で最適解(あるいはUNSAT)を
 得るまでに要した CPU時間を示す．
 \begin{exampleblock}{} \centering 
  \begin{tabular}{crrr}
   問題		& CAFE基準値(km/L)  & 基本符号化(s)   & 改良符号化(s)    \\\hline
   small 	& 8.5              & 37.868         & \alert{23.318}  \\
   small	& 9.0              & 48.965         & \alert{43.362}  \\
   small	& 9.5              & \alert{95.110} & 173.172         \\
   small	& 10.0             & 99.954         & \alert{0.343}   \\
   small	& 10.5             & 439.613        & \alert{0.080}   \\\hline
   \multicolumn{2}{r}{平均}         & 144.302        & \alert{48.055}
  \end{tabular}
 \end{exampleblock}
 \begin{itemize}
  \item 5問中4問に対して，改良符号化の方が高速に解を求めた．
  \item 平均では，改良符号化のCPU時間は基本符号化の約1/3であった．
 \end{itemize}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}{まとめと今後の課題}
 \begin{block}{まとめ}
  \begin{itemize}
   \item CAFE問題に対して解集合プログラミングを初めて適用した．
	 \begin{itemize}
	  \item 記述性の高さ，柔軟な最適解探索などの利点を確認できた．
	 \end{itemize}
   \item 企業から提供された問題集を用いた実験を行った．
	 \begin{itemize}
	  \item 実用規模の問題に対して適用可能であることを確認できた．
	 \end{itemize}
  \end{itemize}
 \end{block}
 \begin{alertblock}{今後の課題}
  \begin{itemize}
   \item CAFE問題ソルバーの拡張
	 \begin{itemize}
	  \item 様々な制約の調査・整理・実装
	 \end{itemize}
  \end{itemize}
 \end{alertblock}
\end{frame}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\end{document}