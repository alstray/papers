%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% ASPで問題を解く流れの図
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{tikzpicture}

 \def\nodehspace{1cm}
 \def\nodevspace{0.5cm}

 \tikzset{block/.style={rectangle, very thick, text centered, draw=black, fill=cyan!10,
 text width=3cm, minimum height=1.5cm}};

 \tikzset{alertblock/.style={rectangle, ultra thick, draw=red, fill=red!10,
 text centered, text width=3cm, minimum height=1.5cm}};

 \tikzset{structureblock/.style={rectangle, very thick, draw=blue!60, fill=white,
 text centered, text width=3cm, minimum height=1.5cm}};

 \node[block](ins){配電網遷移問題\\インスタンス};
 \node[block, densely dotted, right=0.6\nodehspace of ins] (conv){変換器};
 \node[block, right=0.6\nodehspace of conv] (fact){ASPファクト};
 \node[alertblock, below=\nodevspace of fact](encode){\alert{\bf ASP符号化\\(論理プログラム)}};
 \node[structureblock, right=1.3\nodehspace of fact](sys1){ASPシステム};
 \node[block, right=\nodehspace of sys1] (ans){配電網遷移問題\\の解};

 \node[rectangle, draw=blue!60, ultra thick, minimum width=3.6cm, minimum height=4cm, fill=blue!10,
 below=-1.8cm of sys1, label=above:\structure{\bf \Large 提案ソルバー}](solver){};

 \node[structureblock, right=1.3\nodehspace of fact](sys){ASPシステム};
 \node[structureblock, below=\nodevspace of sys](recon){\structure{\bf 配電網遷移問題\\アルゴリズム}};

 \foreach \u / \v / \name in {ins/conv/,conv/fact/,fact/sys/,sys/ans/}
 \draw [very thick,->] (\u) to node[above]{\name} (\v);
 
 \draw [very thick,->] (sys.225) -- (recon.135);
 \draw [very thick,->] (recon.45) -- (sys.315);

 \coordinate [right=\nodevspace of encode] (a);
 \coordinate [above=2.0\nodehspace of a] (b);
 \draw [very thick] (encode) -- (a) -- (b);
 
\end{tikzpicture}