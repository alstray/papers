%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\chapter{カリキュラムベース・コース時間割問題}

%時間割問題は求解困難な組合せ最適化問題の一種である. 社会の様々な場面に応じた種々の時間割が存在し, 現状では, 質の高い時間割を編成するために多くの人間の労力が費やされている. このような背景から, 時間割に関する国際会議 PATAT が 1995 年から開催されている. 主な研究対象として, 教育時間割  (educational timetabling), 輸送時間割 (transport timetabling), 従業員時間割 (employee timetabling), スポーツ時間割 (sports timetabling) などがある.

%その中で教育時間割は, 与えられた制約を満たしながら, 講義や試験などをそれぞれの日時と教室に割り当てることによって編成され, 教育機関にとって重要な問題である. さらに, 教育時間割はコース時間割 (course timetabling), 試験時間割 (examination timetabling), 高校時間割 (school timetabling) に大きく分けられる. また近年では, 国際時間割競技会 ITC も開催され, 時間割ソルバーの性能向上に貢献している.

%\section{カリキュラムベース・コース時間割問題}

本研究が対象とする時間割問題は, カリキュラムベース・コース時間割である. この問題は最も研究が盛んな時間割問題の一つであり, ITC2007 競技会のトラック３で使用された問題である. ITC2007競技会終了後, 時間割問題のポータルサイトが整備され, 問題インスタンス, 最適値・最良値の一覧などが提供されている. 最適値・最良値は, メタヒューリスティクスに基づく各種アルゴリズム, 整数計画法, SAT・MaxSAT などの様々な手法で求められている. 以下では, カリキュラムベース・コース時間割問題を, 単に時間割問題と呼ぶ.

まず, この時間割問題に関する用語を説明する. 課程 (curriculum) は共通の受講者をもつ複数の科目から構成される. 科目 (course) は担当教員, 講義回数, 受講者数などが決められており, 通常の授業科目に対応する. 各科目は複数回の講義から成り, 各講義には曜日 (day) , 時限 (period) および教室 (room) が割り当てられる. 日時は曜日と時限の組で表される.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\lstinputlisting[float=t,caption={%
時間割問題の入力例 (ectt 形式)},%
captionpos=b,frame=single,label=fig;input,%
numbers=none,%
breaklines=true,%
columns=fullflexible,keepspaces=true,%
basicstyle=\ttfamily\scriptsize,
xleftmargin=2cm,xrightmargin=2cm]{code/toy.ectt}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\lstinputlisting[float=t,caption={%
時間割問題の出力例},%
captionpos=b,frame=single,label=fig;output,%
numbers=none,%
breaklines=true,%
columns=fullflexible,keepspaces=true,%
basicstyle=\ttfamily\scriptsize,
xleftmargin=1.9cm,xrightmargin=1.9cm]{code/toy_out.txt}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

時間割問題の入力は, 科目と教室と課程の集合, 曜日と時限の数, １日あたりの講義数の上下限, 開講不可能な科目と日時 (および教室) の組合せの集合である. 出力は, 各科目の全ての講義に対する日時と教室の割り当てである. また, この問題にはハード制約とソフト制約が存在し, ソフト制約に違反するとペナルティが与えられる. 必ず満たすべきハード制約を満たしながら, ペナルティの総和を最小にするような解を求めることが目的である.

時間割問題の入力は ectt と呼ばれるテキスト形式で表される. コード~\ref{fig;input}に入力例を示す. 入力は問題名等を表すヘッダ部分と科目等を表す５つのブロック部分からなる. \code{Name} ヘッダは問題名を表す. \code{Courses} ヘッダは科目数を表す. \code{Rooms} ヘッダは教室数を表す. \code{Days} ヘッダは曜日数を示す. \code{Periods\_per\_day} ヘッダは１日あたりの時限数を表す. \code{Curricula} ヘッダは課程数を表す. \code{Min\_Max\_Daily\_Lectures} ヘッダは各課程における, １日あたりの講義数の上下限を表す. \code{UnavailabilityConstraints} ヘッダは開講不可能な科目と日時の組合せの数を表す. \code{RoomConstraints} ヘッダは開講不可能な科目と教室の組合せの数を表す.

\code{COURSES} ブロックは科目の集合からなる. 各行が１つの科目を表し, 科目名, 教員名, 講義回数, その科目が開講される曜日数の最小値, 受講者数, 連続講義フラグが順に示されている. 連続講義とは, 同一曜日, 同一教室において連続した時限で開講される講義のことである. コード~\ref{fig;input}の例では, 科目 \code{SceCosC} は教員 \code{Ocra} が担当し, 講義回数は週３回で, ３日以上開講し, 受講者数が30名, 同一曜日に２回以上開講される場合は連続講義の形態をとる.

\code{ROOMS} ブロックは教室の集合からなる. 各行が１つの教室を表し, 教室名, 収容可能人数, 建物名が順に示されている. コード~\ref{fig;input}の例では, 教室 \code{rA} は建物\code{１}にあり, 収容可能人数は\code{32}名である.

\code{CURRICULA} ブロックは課程の集合からなる. 各行が１つの課程を表し, 課程名, その課程に属する科目数, その課程に属する全ての科目名が順に示されている. コード~\ref{fig;input}の例では, 課程 \code{Cur1} は \code{SceCosC}, \code{ArcTec}, \code{TecCos} の３つの科目から構成される.

\code{UNAVAILABILITY\_CONSTRAINTS} ブロックは, 開講不可能な科目と日時の組合せの集合からなる. 各行が１つの組合わせを表し, 科目名, 曜日, 時限が順に示されている. コード~\ref{fig;input}の例では, 科目 \code{TecCos} は, 水曜日 (曜日２) の１時限目 (時限０) と２時限目 (時限１), 木曜日 (曜日３) の３時限目 (時限２) と４時限目 (時限３) には開講できない. 

\code{ROOM\_CONSTRAINTS} ブロックは, 開講不可能な科目と教室の組合せの集合からなる. 各行が１つの組み合わせを表し, 科目名, 教室名が順に示されている. コード~\ref{fig;input}の例では, 科目 \code{SceCosC} は教室 \code{rA} では開講できない.

時間割問題の出力は１週間の講義スケジュールであり, 科目名とそれが開講される教室, 曜日, 時限が表される. コード~\ref{fig;output}に, コード~\ref{fig;input}の入力例に対する出力例を示す. この出力では, 科目 \code{SceCosC} は火曜日 (曜日１) の３時限目 (時限２), 木曜日 (曜日３) の４時限目 (時限３), 金曜日 (曜日４) の３時限目 (時限２) にすべて教室 \code{rB} で開講されるということがわかる.\\

次に制約について説明を行う. 時間割問題のハード制約は以下の４つである.

\begin{description}
\item[($H_1$)] \textbf{Lectures:}\\
各科目のすべての講義は, 異なる日時に開講される. 各科目の講義回数は \code{COURSES} ブロックで指定される.
\item[($H_2$)] \textbf{Conflicts:}\\
同一教員が担当する科目のすべての講義は, 異なる日時で開講される. また, 同一課程に属する科目のすべての講義は, 異なる日時で開講される. 各科目の担当教員は \code{COURSES} ブロックで指定され, 各課程に属する科目は \code{CURRICULA} ブロックで指定される.
\item[($H_3$)] \textbf{RoomOccupancy:}\\
同一日時に同一教室で異なる講義を開講できない.
\item[($H_4$)] \textbf{Availability:}\\
各科目の講義は, 開講不可能な日時に開講されることはない. 各科目の開講不可能な日時は \code{UNAVAILABILITY\_CONSTRAINTS} ブロックで指定される.
\end{description}

時間割問題のソフト制約は以下の９つである.

\begin{description}
\item[($S_1$)] \textbf{RoomCapacity:}\\
各科目について, 受講者数が使用する教室の収容可能人数を超えてはいけない. 違反した場合, 超過人数に応じたペナルティが課される. 各科目の受講者数は \code{COURSES} ブロックで指定され, 各教室の収容可能人数は \code{ROOMS} ブロックで指定される.
\item[($S_2$)] \textbf{MinWorkingDays:}\\
各科目について開講される日数が, 指定された開講される曜日数の最小値を下回ってはいけない. 違反した場合, 下回った日数に応じたペナルティが課される. 各科目が開講される曜日数の最小値は \code{COURSES} ブロックで指定される.
\item[($S_3$)] \textbf{IsolatedLectures:}\\
同一課程に属する講義は, 連続した時限に開講される. 同一曜日に同一課程に属する他のどの講義とも隣接していない (孤立した) 講義がある場合に違反となり, 孤立した講義毎にペナルティが課される.
\item[($S_4$)] \textbf{Windows:}\\
同一課程に属する講義は, 空き時限なしで開講される. 同一曜日に同一課程に属する２つの講義の間に空き時限 (同一課程に属する講義のない時限) がある場合に違反となり, 空き時限の長さに応じたペナルティが課される.
\item[($S_5$)] \textbf{RoomStability:}\\
同一科目のすべての講義は, 同一教室で開講される. 違反した場合, 異なる教室数 (最初の教室は除く) に応じたペナルティが課される.
\item[($S_6$)] \textbf{StudentMinMaxLoad:}\\
各課程について, １日あたりの講義数は決められた範囲に収まらなければならない. 違反した場合, 範囲の上限を上回った (あるいは, 下限を下回った) 講義数に応じたペナルティが課される. 各課程の１日あたりの講義数の上下限は \code{Min\_Max\_Daily\_Lectures} ヘッダで指定される.
\item[($S_7$)] \textbf{TravelDistance:}\\
学生は講義と講義の間に建物を移動する時間が必要である. 各課程について, 同一曜日に異なる建物の教室で開講される連続した２つの講義がある場合, すなわち, 瞬間移動が必要な場合に違反となり, 瞬間移動毎にペナルティが課される.
\item[($S_8$)] \textbf{RoomSuitability:}\\
各科目の講義は, 開講不可能な教室で開講されることはない. 違反した講義毎にペナルティが課される. 開講不可能な教室は \code{ROOM\_CO-}\\
\code{NSTRAINTS} ブロックで指定される.
\item[($S_9$)] \textbf{DoubleLectures:}\\
いくつかの科目は連続講義の形態をとる. 連続講義の形態をとる科目は, 同一曜日に複数の講義がある場合, それらは連続した時限に同一教室で開講される. 違反した講義毎にペナルティが課される. 連続講義の形態をとる科目は \code{COURSES} ブロックで指定される.
\end{description}

時間割問題のシナリオとは, 特定のソフト制約の集合と, 各ソフト制約のペナルティに対する重みを加えたものである. 表~\ref{table:const}に, これまでに提案されている５つのシナリオを示す. ``制約" の行は各シナリオの名称を表す. 各シナリオの列はそれぞれ, 整数値がシナリオに含まれるソフト制約に対する重みを, “H” はシナリオに含まれるハード制約を, “-” はシナリオに含まれないことを表している. UD1 は最も基本的なシナリオであり, すべてのハード制約と３つのソフト制約 (S1, S2, S3) からなる. UD2 は ITC2007 競技会で使用されたシナリオである. UD3, UD4, UD5 は比較的新しいシナリオであり, UD3 は各課程の１日当たりの講義数, UD4 は連続講義, UD5 は移動時間に着目したシナリオとなっている.

\begin{table}
  \centering
  \caption{時間割問題の制約とシナリオ}
  \label{table:const}
\begin{tabular}{l|ccccc}\hline
  制約                     			 &  UD1  &  UD2  &  UD3  &  UD4  &  UD5  \\
  \hline
  $H_1$. Lectures       		  &  H    &  H    &  H    &  H    &  H    \\
  $H_2$. Conflicts        		  &  H    &  H    &  H    &  H    &  H    \\
  $H_3$. RoomOccupancy 	  &  H    &  H    &  H    &  H    &  H    \\
  $H_4$. Availability       	 	  &  H    &  H    &  H    &  H    &  H    \\
  \hline
  $S_1$. RoomCapacity     	 &  1    &  1    &  1    &  1    &  1    \\
  $S_2$. MinWorkingDays  	 &  5    &  5    &  -    &  1    &  5    \\
  $S_3$. IsolatedLectures  	 &  1    &  2    &  -    &  -    &  1    \\
  $S_4$. Windows              	 &  -    &  -    &  4    &  1    &  2    \\
  $S_5$. RoomStability      	 &  -    &  1    &  -    &  -    &  -    \\
  $S_6$. StudentMinMaxLoad    &  -    &  -    &  2    &  1    &  2    \\
  $S_7$. TravelDistance 	    	 &  -    &  -    &  -    &  -    &  2    \\
  $S_8$. RoomSuitability   	 &  -    &  -    &  3    &  H    &  -    \\
  $S_9$. DoubleLectures     	 &  -    &  -    &  -    &  1    &  - \\
  \hline
\end{tabular}
\end{table}
  
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "paper"
%%% End:
