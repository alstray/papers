%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\chapter{実行実験}

\section{実験概要}
実装した解法の性能を評価するため, 以下の比較実験を行った.

\begin{itemize}
 \item 比較対象 :
  \begin {enumerate}
   \item \small 既存 ASP 解法 : 系統的探索のみ
   \item 提案解法 R-$n$~ : LNPS + random ($n$ は 0, 10, 20 の３種類) 
   \item 提案解法 R-dp : LNPS + day-period
   \item 提案解法 R-dr : LNPS + day-room
  \end{enumerate}
 \item ベンチマーク : カリキュラムベース・コース時間割ベンチマーク問題 (全 21 問, ソフト制約の多い UD5 シナリオ)
 \item ASP 符号化 : \textit{teaspoon} 符号化
 \cite{%
 banbara17:ramp} 
 \item 制限時間 : １時間
 
 \item 既存 ASP 解法の設定
  \begin{itemize}
   \item \small 二通りのオプションを使用
   \item 使用コマンド :\\
   ・bb~「clingo --opt-strat=bb,0 --restart-on-model --opt-heu=3」\\   
   ・usc「clingo --opt-strat=usc,11 --config=jumpy」
  \end{itemize}
  
 \item 提案解法の設定
  \begin{itemize}
   \item \small 初期解 : 既存 ASP 解法の設定で, 制限時間を30分としたもの
   \item destroy と re-search :\\
   各 destroy 演算をかけ, re-search を 60 秒間行う. これを１サイクルとし, 合計 30 サイクル繰り返す.
   \item 使用コマンド :\\
   既存 ASP 解法のものに各々 --heu=domain を追加した二通り
   \item re-search で得た解の受理条件 : 常に受理
  \end{itemize}
  
\end{itemize}
\newpage

既存 ASP 解法の二通りのオプションは, 
先行研究によって結果の良かった２種類のものを使用した. 
bb に続くコマンドを使用すると分枝限定法を用いた探索を行い, 
usc に続くコマンドを使用すると充足不能コアを用いた探索を行う. 
以下では, それぞれ分枝限定法を bb, 充足不能コアを usc と表記する. 
既存 ASP 解法において, 制限時間が 30 分の解と 60 分の解を比較すると, 
解の改善がみられない, あるいはほとんど改善されなかった問題がしばしば見られた. 
そのため, 提案解法の初期解には 30分時点での解を使用し, 
そこに LNPS を適用することでどれだけ解が改善されるかを実験し確認した. 
また destroy を行った後の re-search に関して, 
bb を用いた探索での予備実験を行ったところ, 
どの destroy 演算においても re-search 開始から 30 秒程度で
目的関数の値の改善が滞っていることが確認できたため, 
１度の re-search にかける時間を 60 秒とした.

実験環境として, CPU は 6コア Intel Core i7 3.2GHz, メモリーは 64GB の Mac mini (OS は macOS Catalina バージョン 10.15.2) を使用した. ASP システムには, \textit{clingo-5.4.0} を使用した.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 

\newenvironment{tableA}{%
%  \scriptsize
  \tabcolsep = 3mm
%  \renewcommand{\arraystretch}{0.9}
  \begin{tabular}[t]{c||r|r|r|r|r|r}\hline
    Instance & 既存ASP解法 & R-0 & R-10 & R-20 & R-dp & R-dr\\\hline
    }{%
    \hline
  \end{tabular}
}

\newenvironment{tableB}{%
%  \scriptsize
  \tabcolsep = 2mm
%  \renewcommand{\arraystretch}{0.9}						
  \begin{tabular}[t]{c||r|r|r|r|r|r|r}\hline
    Instance & 既存ASP解法 & R-0 & R-10 & R-20 & R-dp & R-dr & 既存の最良値\\\hline
    }{%
    \hline
  \end{tabular}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{実験結果}

表~\ref{table:bench:result1}および表~\ref{table:bench:result2}に比較結果を示す.

表~\ref{table:bench:result1}では, ``Instance" の列は問題名を表している. 
``既存ASP解法", ``R-0", ``R-10", ``R-20", ``R-dp", ``R-dr", の列はそれぞれ順に, 
既存ASP解法, 提案解法 R-0, 提案解法 R-10, 提案解法 R-20, 提案解法 R-dp, 提案解法 R-dr 
で求めたペナルティの合計値を表している. 
また各提案解法で re-search を行う際, bb と usc の二通りの探索法で実験を行ったが, 
usc による探索での結果が bb のものと比較した際に
ほぼ全ての結果でペナルティの合計値が大きくなっていた. 
よって, 今回は re-search に bb を用いたもののみ扱う. 
既存ASP解法の列は bb と usc でペナルティの小さかった方を表の結果とした. 
値の右肩には, bb を用いた結果の場合 b, 
usc を用いた結果の場合 u, 
bb と usc で同じ値だった場合 b/u と付けてある. 
提案解法の列では, 使用した初期解が bb と usc による二通りのものがあり, 
ペナルティの小さかった方を表の結果とした. 
こちらも同様にして右肩に文字が付けられている. 
各問題について６種類の手法の中の最良値を太字で表示している. 
表の下２行に関してはそれぞれ, 
各手法において最適値決定が出来た問題の数, 
最適値決定は出来なかったが６種類の手法の中での最良値が求められた問題の数
を表している.

最適値の数に関しては, 
提案解法では全て３問であり, 
既存ASP解法では４問と既存ASP解法の方が１問多かった. 
最良値の数では, R-dp, R-dr がそれぞれ６問, ７問と他の解法より良い結果で, 
次いで R-10 が３問であった. 
それらの合計の数でも, R-dp, R-dr がそれぞれ９問, 
10 問と他の解法より良い結果を示した. 

表~\ref{table:bench:result2}では, ``Instance" の列は問題名を表している. 
``既存の最良値" の列は先行研究によるペナルティの合計値の既知の上界を表す. 
``既存ASP解法", ``R-0", ``R-10", ``R-20", ``R-dp", ``R-dr", の列はそれぞれ, 
「各手法で求められた値」を「既存の最良値の値」で割った数の小数点第２位までを表す. 
最下行は, それぞれの手法で, 前述した計算で算出した比率の 21 問分の平均を表す.

比率に関しては, 既存ASP解法の平均が 5.39 なのに対して, 
R-0, R-10, R-dp, R-dr はより良い結果を示しており, 
R-20 は 7.49 と既存ASP解法よりも悪い結果を示した. 
既存ASP解法より良かった提案解法で比較すると, 
R-dp が 2.56 と最も良く, 次いで R-dr が 2.61 であった. 
次に R-0 が 2.72 と良く, 少し離れて R-10 が 4.63 であった.

\section{分析と考察}

表~\ref{table:bench:result1}の比較では, 
各手法について最適値決定が出来た問題の数が３,４問となっていた. 
ただし, comp04, comp08, comp11 に関しては, usc を用いた既存ASP解法で 30 分実行した段階で最適値決定が既に出来ていた. 
そのため, 該当のベンチマーク問題３問を除くと最適値決定が行えたのは, 
既存ASP解法による comp14 の１問のみであった. 
しかし, R-20 と R-dr による comp11 の結果では, 30 分時点で最適値決定が出来ていなかった, 
bb による初期解を利用した実行でも最適値決定が行えた.

今回, re-search での探索は usc を用いた方で良い結果が得られなかったため, 
bb を用いた方のみ表の結果として採用した. 
これは usc の探索の性質上一度の目的関数の改善に時間がかかる場合があり, 
１回の re-search の制限時間に設定した 60 秒が短かった可能性がある. 
実行結果を解析すると, re-search を usc を用いた探索で行ったものでは一度の re-search で目的関数の値に変化がないまま次の re-search に移っているパターンが 
bb を用いたものよりも多くみられた. 
１回の re-search の時間を長くすることで usc による探索の結果が改善できる可能性がある.

また re-search は bb を用いた探索のみに限定したが, 
初期解の探索法は bb と usc の二通りから結果が良かったものを表に採用した. 
ベンチマーク問題の種類や destroy の手法によって
どちらが良かったかが様々に変わっており, 
現状では初期解を二通り用意してパラレルに実行することで
良い解を得る想定をしている. 
ベンチマーク問題をさらに増やすなどして規則性を見つけることができれば, 
パラレルな実行を行う場合よりリソースを削減できる可能性がある.

既存の最良値に対する比率での比較の際, 
R-0, R-10, R-20 で比較すると, 
解を取り消す割合が大きくなるにつれ結果が悪くなっている.
R-10 や R-20 は局所的最適解に陥らないようにすることを目的としていたが, 
この結果から, 10\% を超えるような割合で解の取り消しを行うと
取り消しを全く行わないものより結果が悪くなると考えられる. 
 
R-dp, R-dr は最良値の数の比較と, 既存の最良値に対する比率での比較の両方で
他の手法より良い結果が得られた. 
そこで, 表に結果として採用した実行において, 
両手法における destroy 演算で解をどれだけの割合取り消していたかを解析した. 
各問題について 30 回 destroy 演算が施されており, 
各 destroy 演算でそれぞれ解の取り消しの割合は異なる. 
そこで, 各問題ごとに30 回分の取り消し割合の平均を計算し, 
その値からさらに 21 問分の平均を計算した. 
その結果, R-dp は 3.77\%, R-dr は 1.55\% (小数第二位まで計算) であった. 
そこで, 実行実験において提案解法 R-$n$ の $n$ として０,10, 20, を設定し実験を行ったが, 
新たに $n$ として 3.77, 1.55 を設定し追加実験を行った. 
既存の最良値に対する比率の平均を算出した結果, 
R-3.77 では 2.59, R-1.55 では 2.57 という結果が得られた.
この結果から, R-dp, R-dr と近い良い結果が得られており, 
R-dp, R-dr とは効き方にどのような差があるのか調べることが今後の課題の一つとなる. 

また以上の結果から, 
解の取り消し割合を 10\%, 20\% と大きくしていくと
結果が悪くなったが, 0\% よりも良い結果が 1.55\% や 3.77\% で得られた. 
0\% から 10\% の間にさらに良い結果が得られるような
取り消しの割合が存在する可能性があり, 
さらなる実験によって調べる必要がある. 


\begin{table}[htbp]
  \caption{実験結果: 求められた最良値}
  \label{table:bench:result1}
  \centering
  \begin{tableA}
    \input{value}
  \end{tableA}
\end{table}

\begin{table}[htbp]
  \caption{比較結果: 既存の最良値を１とした場合の比率}
  \label{table:bench:result2}
  \centering
  \begin{tableB}
    \input{ratio}
  \end{tableB}
\end{table}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "paper"
%%% End:
